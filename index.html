<script>
  (function () {
    function boot() {
      if (typeof H5PStandalone === "undefined") return;

      const { H5P } = H5PStandalone;
      const container = document.getElementById("h5p-container");

      new H5P(container, {
        h5pJsonPath: "h5p-folder",
        frameJs: "dist/frame.bundle.js",
        frameCss: "dist/styles/h5p.css"
      });

      // ---- add this rewrite helper ----
      const prefix = "h5p-folder/content/";
      const fixAssets = (root) => {
        if (!root || !root.querySelectorAll) return;
        root.querySelectorAll('[src^="file-"], [poster^="file-"]').forEach(el => {
          const s = el.getAttribute("src");
          if (s && s.indexOf("file-") === 0) el.setAttribute("src", prefix + s);
          const p = el.getAttribute("poster");
          if (p && p.indexOf("file-") === 0) el.setAttribute("poster", prefix + p);
        });
        root.querySelectorAll('a[href^="file-"]').forEach(a => {
          const h = a.getAttribute("href");
          if (h && h.indexOf("file-") === 0) a.setAttribute("href", prefix + h);
        });
        // <source> tags inside <video>/<audio>
        root.querySelectorAll('source[src^="file-"]').forEach(s => {
          const v = s.getAttribute("src");
          if (v && v.indexOf("file-") === 0) s.setAttribute("src", prefix + v);
        });
      };

      // run once and also watch for dynamically added content
      const mo = new MutationObserver(() => fixAssets(container));
      mo.observe(container, { subtree: true, childList: true });
      fixAssets(container);
      // ---- end rewrite helper ----
    }
    document.readyState === "loading"
      ? document.addEventListener("DOMContentLoaded", boot)
      : boot();
  })();
</script>
